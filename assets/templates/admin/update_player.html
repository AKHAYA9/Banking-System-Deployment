{% extends "admin/home.html" %}

{% block title %}Update Player - SecureBank{% endblock %}
{% block page_title %}Update Player Balance{% endblock %}
{% block page_description %}Modify player wallet balance{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-card">
        <div class="form-header">
            <div class="header-icon">
                <i class="fas fa-edit"></i>
            </div>
            <div>
                <h2>Update Player Balance</h2>
                <p>Adjust wallet balance for {{ player.name }}</p>
            </div>
        </div>

        <form method="POST" action="{% url 'update_player' player.id %}" class="update-form">
            {% csrf_token %}

            <!-- Player Info Card -->
            <div class="player-info-card">
                <div class="player-avatar-large">
                    {{ player.name|slice:":1"|upper }}
                </div>
                <div class="player-details">
                    <h3>{{ player.name }}</h3>
                    {% if player.user %}
                        <div class="detail-row">
                            <i class="fas fa-user"></i>
                            <span>Linked User: <strong>{{ player.user.username }}</strong></span>
                        </div>
                        <div class="detail-row">
                            <i class="fas fa-envelope"></i>
                            <span>{{ player.user.email }}</span>
                        </div>
                    {% else %}
                        <div class="detail-row">
                            <i class="fas fa-unlink"></i>
                            <span class="text-muted">No linked user account</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Current Balance Display -->
            <div class="balance-display">
                <div class="balance-label">Current Balance</div>
                <div class="current-balance {% if player.balance >= 0 %}positive{% else %}negative{% endif %}">
                    ₹{{ player.balance|floatformat:2 }}
                </div>
            </div>

            <!-- New Balance Input -->
            <div class="form-group">
                <label for="balance">
                    <i class="fas fa-wallet"></i> New Balance (₹)
                    <span class="required">*</span>
                </label>
                <input type="number" class="form-control balance-input" id="balance" name="balance" 
                       step="0.01" value="{{ player.balance }}" required 
                       onchange="updateBalancePreview()">
                <small class="form-text">Enter the new wallet balance amount</small>
            </div>

            <!-- Balance Change Preview -->
            <div class="change-preview" id="changePreview">
                <div class="preview-header">
                    <i class="fas fa-exchange-alt"></i>
                    <strong>Balance Change Preview</strong>
                </div>
                <div class="preview-grid">
                    <div class="preview-item">
                        <span class="preview-label">Current Balance:</span>
                        <span class="preview-value current">₹{{ player.balance|floatformat:2 }}</span>
                    </div>
                    <div class="preview-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">New Balance:</span>
                        <span class="preview-value new" id="newBalancePreview">₹{{ player.balance|floatformat:2 }}</span>
                    </div>
                </div>
                <div class="change-indicator" id="changeIndicator">
                    <div class="change-amount" id="changeAmount"></div>
                    <div class="change-type" id="changeType"></div>
                </div>
            </div>

            <!-- Warning Alert -->
            <div class="warning-alert">
                <div class="alert-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="alert-content">
                    <strong>Important!</strong>
                    <p>This will directly update the player's wallet balance. Make sure the amount is correct before saving.</p>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <a href="{% url 'admin_home' %}" class="btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i> Update Balance
                </button>
            </div>
        </form>
    </div>

    <!-- Quick Actions Card -->
    <div class="quick-actions-card">
        <div class="actions-header">
            <i class="fas fa-bolt"></i>
            <h3>Quick Actions</h3>
        </div>
        <div class="actions-list">
            <a href="{% url 'reset_player_balance' player.id %}" class="action-item warning" 
               onclick="return confirm('Reset {{ player.name }}\'s balance to ₹0.00?');">
                <div class="action-icon">
                    <i class="fas fa-undo"></i>
                </div>
                <div class="action-info">
                    <strong>Reset Balance</strong>
                    <p>Set balance to ₹0.00</p>
                </div>
            </a>
            
            <a href="{% url 'add_transaction' %}" class="action-item success">
                <div class="action-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div class="action-info">
                    <strong>Add Transaction</strong>
                    <p>Record a new game transaction</p>
                </div>
            </a>
            
            <a href="{% url 'delete_player' player.id %}" class="action-item danger" 
               onclick="return confirm('Delete {{ player.name }}\'s player account? This cannot be undone!');">
                <div class="action-icon">
                    <i class="fas fa-trash"></i>
                </div>
                <div class="action-info">
                    <strong>Delete Player</strong>
                    <p>Remove player account</p>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
.form-container {
    max-width: 800px;
    margin: 0 auto;
}

.form-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    overflow: hidden;
    margin-bottom: 30px;
}

.form-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 25px 30px;
    display: flex;
    align-items: center;
    gap: 20px;
    color: white;
}

.header-icon {
    width: 50px;
    height: 50px;
    background: rgba(255,255,255,0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.form-header h2 {
    font-size: 24px;
    margin-bottom: 5px;
}

.form-header p {
    font-size: 14px;
    opacity: 0.9;
}

.update-form {
    padding: 30px;
}

/* Player Info Card */
.player-info-card {
    background: linear-gradient(135deg, #f8f9fa, #ffffff);
    border: 2px solid #667eea;
    border-radius: 12px;
    padding: 25px;
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 25px;
}

.player-avatar-large {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 36px;
    font-weight: 700;
    flex-shrink: 0;
}

.player-details {
    flex: 1;
}

.player-details h3 {
    font-size: 24px;
    color: #333;
    margin-bottom: 10px;
}

.detail-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
    color: #666;
    font-size: 14px;
}

.detail-row i {
    color: #667eea;
    width: 16px;
}

/* Balance Display */
.balance-display {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    margin-bottom: 25px;
    color: white;
}

.balance-label {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.current-balance {
    font-size: 48px;
    font-weight: 700;
}

/* Form Group */
.form-group {
    margin-bottom: 25px;
}

.form-group label {
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.required {
    color: #ff4757;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
}

.balance-input {
    font-size: 24px;
    font-weight: 600;
    text-align: center;
    color: #333;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-text {
    display: block;
    margin-top: 6px;
    font-size: 12px;
    color: #999;
    text-align: center;
}

/* Change Preview */
.change-preview {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.preview-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    color: #667eea;
    font-size: 16px;
}

.preview-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: center;
    margin-bottom: 20px;
}

.preview-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}

.preview-label {
    display: block;
    font-size: 12px;
    color: #999;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.preview-value {
    font-size: 24px;
    font-weight: 700;
}

.preview-value.current {
    color: #666;
}

.preview-value.new {
    color: #667eea;
}

.preview-arrow {
    color: #667eea;
    font-size: 24px;
}

.change-indicator {
    background: white;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
}

.change-amount {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 5px;
}

.change-type {
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Warning Alert */
.warning-alert {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    border-radius: 10px;
    padding: 15px 20px;
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
}

.alert-icon {
    color: #856404;
    font-size: 20px;
}

.alert-content strong {
    display: block;
    color: #856404;
    margin-bottom: 5px;
    font-size: 14px;
}

.alert-content p {
    color: #856404;
    font-size: 13px;
    line-height: 1.5;
    margin: 0;
}

/* Form Actions */
.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid #e9ecef;
}

.btn-primary, .btn-secondary {
    padding: 12px 30px;
    border-radius: 8px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
    border: none;
    cursor: pointer;
    text-decoration: none;
    font-size: 14px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
    background: #e9ecef;
    color: #666;
}

.btn-secondary:hover {
    background: #dee2e6;
}

/* Quick Actions Card */
.quick-actions-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    padding: 25px;
}

.actions-header {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #667eea;
    margin-bottom: 20px;
}

.actions-header i {
    font-size: 24px;
}

.actions-header h3 {
    font-size: 18px;
    color: #333;
}

.actions-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.action-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border-radius: 10px;
    text-decoration: none;
    transition: all 0.3s;
    border: 2px solid #e9ecef;
}

.action-item:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.action-item.warning {
    border-color: #ffc107;
}

.action-item.warning:hover {
    background: #fff3cd;
}

.action-item.success {
    border-color: #28a745;
}

.action-item.success:hover {
    background: #d4edda;
}

.action-item.danger {
    border-color: #dc3545;
}

.action-item.danger:hover {
    background: #f8d7da;
}

.action-icon {
    width: 45px;
    height: 45px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.action-item.warning .action-icon {
    background: #fff3cd;
    color: #856404;
}

.action-item.success .action-icon {
    background: #d4edda;
    color: #155724;
}

.action-item.danger .action-icon {
    background: #f8d7da;
    color: #721c24;
}

.action-info strong {
    display: block;
    color: #333;
    font-size: 14px;
    margin-bottom: 3px;
}

.action-info p {
    color: #999;
    font-size: 12px;
    margin: 0;
}

@media (max-width: 768px) {
    .player-info-card {
        flex-direction: column;
        text-align: center;
    }

    .preview-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .preview-arrow {
        transform: rotate(90deg);
    }

    .form-actions {
        flex-direction: column;
    }

    .btn-primary, .btn-secondary {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
const originalBalance = parseFloat({{ player.balance }});

function updateBalancePreview() {
    const newBalance = parseFloat(document.getElementById('balance').value) || 0;
    const change = newBalance - originalBalance;
    
    // Update new balance display
    document.getElementById('newBalancePreview').textContent = `₹${newBalance.toFixed(2)}`;
    
    // Update change indicator
    const changeAmountEl = document.getElementById('changeAmount');
    const changeTypeEl = document.getElementById('changeType');
    
    if (change > 0) {
        changeAmountEl.textContent = `+₹${change.toFixed(2)}`;
        changeAmountEl.style.color = '#28a745';
        changeTypeEl.textContent = 'Increase';
        changeTypeEl.style.color = '#28a745';
    } else if (change < 0) {
        changeAmountEl.textContent = `₹${change.toFixed(2)}`;
        changeAmountEl.style.color = '#dc3545';
        changeTypeEl.textContent = 'Decrease';
        changeTypeEl.style.color = '#dc3545';
    } else {
        changeAmountEl.textContent = '₹0.00';
        changeAmountEl.style.color = '#999';
        changeTypeEl.textContent = 'No Change';
        changeTypeEl.style.color = '#999';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updateBalancePreview();
});
</script>
{% endblock %}