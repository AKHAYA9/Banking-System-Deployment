<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>.table {
    border-radius: 12px;
    overflow: hidden;
    background-color: #222;
}
.table-hover tbody tr:hover {
    background-color: rgba(255, 193, 7, 0.1);
}

/* ===== Thumbnail Image ===== */
.thumbnail-img {
    width: 80px;
    height: 60px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.thumbnail-img:hover {
    transform: scale(1.1);
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.6);
}
.image-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(6px);
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease-in-out;
}

/* Centered image with perfect scaling */
.image-modal img {
    max-width: 80vw;     /* fits horizontally */
    max-height: 80vh;    /* fits vertically */
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(255, 193, 7, 0.6);
    object-fit: contain;
    transition: transform 0.3s ease;
}

/* Close Button */
.image-modal .close-btn {
    position: absolute;
    top: 25px;
    right: 40px;
    color: #fff;
    font-size: 38px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease;
}
.image-modal .close-btn:hover {
    color: #ffc107;
}
</style>
</head>
<body class="bg-dark text-light">

<div class="container py-4">
    <!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-warning mb-0">üì∏ Match Result Screenshots</h2>
  <div>
    <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#uploadResultModal">
      ‚ûï Upload Match Result
    </button>
    <button class="btn btn-outline-info btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#updateModal">
    <i class="bi bi-pencil-square"></i> Update Match
</button>
    <a href="{% url 'home' %}" class="btn btn-outline-info btn-sm ms-2">üè† Back to Home</a>
  </div>
</div>

{% if results %}
<div class="container py-4">
    <div class="table-responsive">
        <table class="table table-dark table-hover align-middle text-center border border-warning border-opacity-50 shadow-lg rounded-3 overflow-hidden">
            <thead class="table-warning text-dark">
                <tr>
                    <th>Screenshot</th>
                    <th>Date</th>
                    <th>Time Slot</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <!-- Thumbnail (click to open popup) -->
                    <td>
                        <img src="{{ result.screenshot.url }}" 
                             alt="Match Screenshot"
                             class="thumbnail-img rounded shadow-sm"
                             onclick="openImageModal('{{ result.screenshot.url }}')">
                    </td>

                    <!-- Date -->
                    <td class="fw-semibold text-warning">
                        {{ result.date|date:"d M Y" }}
                    </td>

                    <!-- Time Slot -->
                    <td class="text-light">{{ result.time_slot }}</td>

                    <!-- Description -->
                    <td>
                        {% if result.description %}
                            <span class="text-light">{{ result.description }}</span>
                        {% else %}
                            <span class="text-muted fst-italic small">No description</span>
                        {% endif %}
                    </td>

                    <!-- Actions -->
<td class="text-center">
    <!-- Download Button -->
    <a href="{{ result.screenshot.url }}" download 
       class="btn btn-sm btn-outline-warning rounded-circle me-2 shadow-sm"
       title="Download Screenshot">
       <i class="bi bi-download"></i>
    </a>

    <!-- Delete Button -->
    <a href="{% url 'delete_match_result' result.id %}" 
       onclick="return confirm('üóë Are you sure you want to delete this match screenshot?')" 
       class="btn btn-sm btn-outline-danger rounded-circle shadow-sm"
       title="Delete Screenshot">
       <i class="bi bi-trash3"></i>
    </a>
</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- üîç Image Popup Modal -->
<div id="imageModal" class="image-modal">
    <span class="close-btn" onclick="closeImageModal()">√ó</span>
    <img id="modalImage" src="" alt="Full Screenshot">
</div>

{% else %}
<p class="text-center text-secondary mt-5 fs-5">‚ö†Ô∏è No match results uploaded yet.</p>
{% endif %}

<!-- Upload Modal -->
<div class="modal fade" id="uploadResultModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light border-warning">
      <div class="modal-header bg-warning bg-opacity-25">
        <h5 class="modal-title">üì§ Upload Match Result</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{% url 'match_results' %}" enctype="multipart/form-data" id="uploadForm">
        {% csrf_token %}
        <div class="modal-body">

          <label class="form-label">üìÖ Match Date:</label>
          <input type="date" name="date" class="form-control bg-dark text-light border-warning mb-2" required>

          <label class="form-label">üïí Match Time:</label>
          <select name="time_slot" class="form-select bg-dark text-light border-warning mb-2" required>
            <option value="12 PM">12 PM</option>
            <option value="3 PM">3 PM</option>
            <option value="6 PM">6 PM</option>
            <option value="8 PM">8 PM</option>
            <option value="9 PM">9 PM</option>
            <option value="11 PM">11 PM</option>
            <option value="12 AM">12 AM</option>
          </select>

          <label class="form-label">üñº Upload Screenshot:</label>
          <!-- Drag and Drop Area -->
          <div id="dropzone" class="border border-warning border-dashed rounded p-3 mb-2 text-center"
               style="cursor: pointer;">
            Drag & Drop your image here or click to select
            <input type="file" name="screenshot" id="fileInput" class="d-none" accept="image/*" required>
          </div>
          <small id="fileName" class="text-warning"></small>

          <label class="form-label mt-2">üìù Description (optional):</label>
          <textarea name="description" class="form-control bg-dark text-light border-warning" rows="2"></textarea>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-warning text-dark fw-bold">Upload</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Update Match Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content bg-dark text-light border border-info border-opacity-50">
      <div class="modal-header border-info">
        <h5 class="modal-title text-info" id="updateModalLabel">‚úèÔ∏è Update Match Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" enctype="multipart/form-data" action="{% url 'update_match_result' %}">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Select Match:</label>
            <select class="form-select bg-dark text-light border-secondary" name="match_id" required>
              {% for result in results %}
                <option value="{{ result.id }}">{{ result.date }} ‚Äî {{ result.time_slot }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Date:</label>
            <input type="date" class="form-control bg-dark text-light border-secondary" name="date" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Time Slot:</label>
            <select class="form-select bg-dark text-light border-secondary" name="time_slot" required>
              <option value="12PM">12 PM</option>
              <option value="3PM">3 PM</option>
              <option value="6PM">6 PM</option>
              <option value="8PM">8 PM</option>
              <option value="9PM">9 PM</option>
              <option value="11PM">11 PM</option>
              <option value="12AM">12 AM</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Description (optional):</label>
            <textarea class="form-control bg-dark text-light border-secondary" name="description" rows="2"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Replace Screenshot (optional):</label>
            <input type="file" class="form-control bg-dark text-light border-secondary" name="screenshot">
          </div>
        </div>

        <div class="modal-footer border-info">
          <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-info btn-sm">üíæ Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<script>
function openImageModal(imageUrl) {
    const modal = document.getElementById("imageModal");
    const modalImage = document.getElementById("modalImage");
    modal.style.display = "flex";
    modalImage.src = imageUrl;
}

function closeImageModal() {
    document.getElementById("imageModal").style.display = "none";
}

  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('fileInput');
  const fileName = document.getElementById('fileName');

  // Click on dropzone triggers file select
  dropzone.addEventListener('click', () => fileInput.click());

  // Highlight dropzone on drag over
  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('bg-warning', 'bg-opacity-25');
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('bg-warning', 'bg-opacity-25');
  });

  // Handle dropped files
  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('bg-warning', 'bg-opacity-25');
    if (e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files; // Assign dropped files to input
      fileName.textContent = e.dataTransfer.files[0].name;
    }
  });

  // Show selected file name
  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      fileName.textContent = fileInput.files[0].name;
    }
  });
</script>